generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Workspace {
  id          String   @id @default(uuid())
  name        String   @default("My Startup")
  ownerId     String   @unique
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  profile     FounderProfile?
  onboarding  OnboardingState?
  competitors Competitor[]
  tasks       Task[]
  alerts      Alert[]
  agentOutputs AgentOutput[]
  files       File[]
  
  @@index([ownerId])
  @@map("workspaces")
}

model FounderProfile {
  id          String   @id @default(uuid())
  workspaceId String   @unique
  
  stage              String?
  productDescription String?  @db.Text
  problemSolved      String?  @db.Text
  idealCustomer      String?  @db.Text
  revenueModel       String?  @db.Text
  competitors        Json?
  budgetSituation    String?  @db.Text
  runwayMonths       Int?
  goal90Day          String?  @db.Text
  biggestConcern     String?  @db.Text
  
  extractedData      Json?
  confirmedSummary   Json?
  
  status             String   @default("incomplete")
  onboardingComplete Boolean  @default(false)
  confirmedAt        DateTime?
  
  workspace          Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  
  @@map("founder_profiles")
}

model OnboardingState {
  id          String   @id @default(uuid())
  workspaceId String   @unique
  
  status          String   @default("in_progress")
  currentQuestion String   @default("stage")
  
  answers         Json
  extractedInfo   Json
  uploadedFiles   Json
  corrections     Json?
  additionalInfo  Json?
  
  generatedSummary String? @db.Text
  summaryData      Json?
  
  startedAt        DateTime @default(now())
  lastMessageAt    DateTime @default(now())
  completedAt      DateTime?
  
  workspace        Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  
  @@map("onboarding_states")
}

model Competitor {
  id          String   @id @default(uuid())
  workspaceId String
  
  name         String
  website      String
  description  String?  @db.Text
  
  threatLevel  String?  @default("medium")
  pricing      Json?
  features     Json?
  positioning  String?  @db.Text
  strengths    String[] @default([])
  weaknesses   String[] @default([])
  
  lastChecked  DateTime @default(now())
  checkFrequency String @default("weekly")
  
  workspace    Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  @@index([workspaceId])
  @@map("competitors")
}

model Task {
  id          String   @id @default(uuid())
  workspaceId String
  agentId     String
  
  type        String
  status      String   @default("pending")
  priority    String   @default("medium")
  
  title       String
  description String?  @db.Text
  input       Json?
  output      Json?
  
  requiresApproval Boolean @default(true)
  approvalPrompt   String?  @db.Text
  approvedAt       DateTime?
  approvedBy       String?
  
  startedAt   DateTime?
  completedAt DateTime?
  dueDate     DateTime?
  
  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  @@index([workspaceId, status])
  @@index([agentId, status])
  @@map("tasks")
}

model Alert {
  id          String   @id @default(uuid())
  workspaceId String
  
  type          String
  severity      String
  
  title         String
  description   String   @db.Text
  changes       Json?
  
  read          Boolean  @default(false)
  readAt        DateTime?
  actioned      Boolean  @default(false)
  actionTaken   String?  @db.Text
  
  workspace     Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  
  createdAt     DateTime @default(now())
  
  @@index([workspaceId, read])
  @@map("alerts")
}

model AgentOutput {
  id          String   @id @default(uuid())
  workspaceId String
  agentId     String
  
  type        String
  content     Json
  rawContent  String?  @db.Text
  
  taskId      String?
  tags        String[] @default([])
  usedByAgents String[] @default([])
  
  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  @@index([workspaceId, agentId])
  @@map("agent_outputs")
}

model File {
  id          String   @id @default(uuid())
  workspaceId String
  
  name        String
  type        String
  size        Int
  category    String
  
  storagePath String?
  url         String?
  
  processed   Boolean  @default(false)
  processedAt DateTime?
  extractedText String? @db.Text
  
  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime  @default(now())
  
  @@index([workspaceId, category])
  @@map("files")
}
