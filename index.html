<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Foundry</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background: #0a0a0f; 
      color: #fff; 
      min-height: 100vh;
      padding: 16px;
      font-size: 16px;
    }
    h1 { font-size: 24px; margin-bottom: 4px; font-weight: 700; }
    .subtitle { color: #6b7280; font-size: 14px; margin-bottom: 20px; }
    .card {
      background: #18181b;
      border: 1px solid #27272a;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
    }
    input {
      width: 100%;
      background: #0a0a0f;
      border: 1px solid #3f3f46;
      padding: 14px 16px;
      border-radius: 10px;
      color: #fff;
      font-size: 16px;
      margin-bottom: 12px;
      -webkit-appearance: none;
    }
    input:focus { outline: none; border-color: #6366f1; }
    button {
      width: 100%;
      background: #4f46e5;
      color: #fff;
      padding: 14px 24px;
      border-radius: 10px;
      border: none;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      -webkit-appearance: none;
    }
    button:active { transform: scale(0.98); }
    button:disabled { background: #3f3f46; }
    .msg { padding: 12px; border-radius: 8px; margin-bottom: 12px; font-size: 14px; }
    .msg-success { background: #064e3b; border: 1px solid #10b981; color: #10b981; }
    .msg-error { background: #7f1d1d; border: 1px solid #ef4444; color: #ef4444; }
    .pending-box { background: #292524; border: 1px solid #f59e0b; padding: 16px; border-radius: 10px; margin-bottom: 12px; }
    .pending-box p { margin-bottom: 12px; font-size: 14px; }
    .approve-btn { background: #059669; }
    .competitor-box { background: #18181b; border: 1px solid #27272a; padding: 14px; border-radius: 10px; margin-bottom: 8px; }
    .competitor-box .name { font-weight: 600; margin-bottom: 4px; }
    .competitor-box .url { color: #6b7280; font-size: 13px; text-decoration: none; }
    .badge { 
      display: inline-block;
      padding: 4px 10px; 
      border-radius: 4px; 
      font-size: 12px; 
      font-weight: 600;
      float: right;
    }
    .badge-high { background: #7f1d1d; color: #fca5a5; }
    .badge-medium { background: #78350f; color: #fcd34d; }
    h3 { font-size: 14px; color: #9ca3af; margin: 20px 0 12px; text-transform: uppercase; letter-spacing: 0.5px; }
  </style>
</head>
<body>
  <h1>ðŸŽ¯ Foundry</h1>
  <p class="subtitle">AI Co-Founder Platform</p>
  
  <div id="msg"></div>
  
  <div class="card">
    <input type="text" id="input" placeholder="What are you building? (e.g., CRM for dentists)">
    <button id="btn" onclick="discover()">Discover Competitors</button>
  </div>
  
  <div id="pending"></div>
  <div id="competitors"></div>

  <script>
    const API = 'https://foundry-production-7b5f.up.railway.app';
    
    function show(txt, isError) {
      document.getElementById('msg').innerHTML = '<div class="msg ' + (isError ? 'msg-error' : 'msg-success') + '">' + txt + '</div>';
    }
    
    async function load() {
      try {
        const r = await fetch(API + '/api/workspaces/demo');
        const d = await r.json();
        render(d.tasks || [], d.competitors || []);
      } catch(e) {
        show('Connection error', true);
      }
    }
    
    async function discover() {
      const input = document.getElementById('input');
      const btn = document.getElementById('btn');
      
      if(!input.value.trim()) { show('Enter product description', true); return; }
      
      btn.disabled = true;
      btn.textContent = 'Creating...';
      
      try {
        const r = await fetch(API + '/api/workspaces/demo/competitors/discover', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({productDescription: input.value})
        });
        const d = await r.json();
        if(d.taskId) {
          show('Task created! Approve below');
          input.value = '';
          load();
        } else {
          show('Failed to create task', true);
        }
      } catch(e) {
        show('Error: ' + e.message, true);
      }
      
      btn.disabled = false;
      btn.textContent = 'Discover Competitors';
    }
    
    async function approve(id) {
      const btn = document.getElementById('a-' + id);
      btn.disabled = true;
      btn.textContent = 'Running...';
      
      try {
        const r = await fetch(API + '/api/tasks/' + id + '/approve', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({userId: 'founder'})
        });
        const d = await r.json();
        if(d.success) {
          show('Found ' + d.competitorsFound + ' competitors!');
          render(d.competitors ? [] : [], d.competitors || []);
          load();
        }
      } catch(e) {
        show('Error', true);
        btn.disabled = false;
        btn.textContent = 'Approve';
      }
    }
    
    function render(tasks, competitors) {
      const pending = tasks.filter(t => t.status === 'pending' && t.requiresApproval);
      let html = '';
      
      if(pending.length) {
        html += '<h3>Pending Approval</h3>';
        pending.forEach(t => {
          html += '<div class="pending-box"><p>' + t.approvalPrompt + '</p><button id="a-' + t.id + '" class="approve-btn" onclick="approve(\'' + t.id + '\')">Approve & Run</button></div>';
        });
      }
      document.getElementById('pending').innerHTML = html;
      
      html = '';
      if(competitors.length) {
        html += '<h3>Competitors (' + competitors.length + ')</h3>';
        competitors.forEach(c => {
          html += '<div class="competitor-box"><span class="badge badge-' + c.threatLevel + '">' + c.threatLevel + '</span><div class="name">' + c.name + '</div><a href="' + c.website + '" class="url" target="_blank">' + c.website + '</a></div>';
        });
      }
      document.getElementById('competitors').innerHTML = html;
    }
    
    load();
    setInterval(load, 3000);
  </script>
</body>
</html>
