<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Foundry - AI Co-Founder</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0a0a0f; 
      color: white; 
      min-height: 100vh;
      padding: 20px;
    }
    .container { max-width: 800px; margin: 0 auto; }
    h1 { font-size: 28px; margin-bottom: 8px; }
    .subtitle { color: #6b7280; margin-bottom: 24px; }
    .card {
      background: #18181b;
      border: 1px solid #3f3f46;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 16px;
    }
    input {
      width: 100%;
      background: #0a0a0f;
      border: 1px solid #3f3f46;
      padding: 12px 16px;
      border-radius: 8px;
      color: white;
      font-size: 16px;
      margin-bottom: 12px;
    }
    button {
      background: #4f46e5;
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 16px;
    }
    button:disabled {
      background: #3f3f46;
      cursor: not-allowed;
    }
    .message {
      background: #064e3b;
      border: 1px solid #10b981;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 16px;
      color: #10b981;
    }
    .pending {
      background: #1c1917;
      border: 1px solid #f59e0b;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 12px;
    }
    .competitor {
      background: #18181b;
      border: 1px solid #3f3f46;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .badge {
      padding: 4px 12px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }
    .badge-high { background: #7f1d1d; color: #fca5a5; }
    .badge-medium { background: #78350f; color: #fcd34d; }
    .badge-low { background: #064e3b; color: #6ee7b7; }
    .loading { opacity: 0.5; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸŽ¯ Foundry</h1>
    <p class="subtitle">AI Co-Founder - Competitor Intelligence Agent</p>
    
    <div id="message"></div>
    
    <div class="card">
      <input type="text" id="productInput" placeholder="Describe your product (e.g., 'A CRM for dentists')...">
      <button id="discoverBtn" onclick="discoverCompetitors()">Discover Competitors</button>
    </div>
    
    <div id="pendingSection"></div>
    <div id="competitorsSection"></div>
  </div>

  <script>
    const API_URL = 'https://foundry-production-7b5f.up.railway.app';
    let tasks = [];
    let competitors = [];

    async function fetchData() {
      try {
        const res = await fetch(`${API_URL}/api/workspaces/demo`);
        const data = await res.json();
        tasks = data.tasks || [];
        competitors = data.competitors || [];
        render();
      } catch (error) {
        console.error('Error:', error);
      }
    }

    async function discoverCompetitors() {
      const input = document.getElementById('productInput');
      const btn = document.getElementById('discoverBtn');
      
      if (!input.value.trim()) return;
      
      btn.disabled = true;
      btn.textContent = 'Creating task...';
      
      try {
        const res = await fetch(`${API_URL}/api/workspaces/demo/competitors/discover`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ productDescription: input.value })
        });
        const data = await res.json();
        
        if (data.taskId) {
          showMessage('Task created! Click "Approve & Run" below.');
          input.value = '';
          await fetchData();
        }
      } catch (error) {
        showMessage('Error: ' + error.message);
      }
      
      btn.disabled = false;
      btn.textContent = 'Discover Competitors';
    }

    async function approveTask(taskId) {
      const btn = document.getElementById(`approve-${taskId}`);
      btn.disabled = true;
      btn.textContent = 'Running...';
      
      try {
        const res = await fetch(`${API_URL}/api/tasks/${taskId}/approve`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ userId: 'founder-1' })
        });
        const data = await res.json();
        
        if (data.success) {
          showMessage(`Found ${data.competitorsFound} competitors!`);
          competitors = data.competitors || [];
          await fetchData();
        }
      } catch (error) {
        showMessage('Error: ' + error.message);
        btn.disabled = false;
        btn.textContent = 'Approve & Run';
      }
    }

    function showMessage(text) {
      document.getElementById('message').innerHTML = `<div class="message">${text}</div>`;
    }

    function render() {
      // Render pending tasks
      const pending = tasks.filter(t => t.status === 'pending' && t.requiresApproval);
      const pendingSection = document.getElementById('pendingSection');
      
      if (pending.length > 0) {
        pendingSection.innerHTML = '<h3 style="color: #f59e0b; margin-bottom: 12px;">Pending Approval</h3>' +
          pending.map(task => `
            <div class="pending">
              <p style="margin-bottom: 12px;">${task.approvalPrompt}</p>
              <button id="approve-${task.id}" onclick="approveTask('${task.id}')" style="background: #059669;">Approve & Run</button>
            </div>
          `).join('');
      } else {
        pendingSection.innerHTML = '';
      }
      
      // Render competitors
      const compSection = document.getElementById('competitorsSection');
      if (competitors.length > 0) {
        compSection.innerHTML = '<h3 style="margin-bottom: 12px;">Discovered Competitors (' + competitors.length + ')</h3>' +
          competitors.map(comp => `
            <div class="competitor">
              <div>
                <p style="font-weight: bold;">${comp.name}</p>
                <a href="${comp.website}" target="_blank" style="color: #6b7280; font-size: 14px; text-decoration: none;">${comp.website}</a>
              </div>
              <span class="badge badge-${comp.threatLevel}">${comp.threatLevel} threat</span>
            </div>
          `).join('');
      } else {
        compSection.innerHTML = '';
      }
    }

    // Load data on page load
    fetchData();
    // Refresh every 5 seconds
    setInterval(fetchData, 5000);
  </script>
</body>
</html>
